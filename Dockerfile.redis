FROM redis/redis-stack-server:latest
EXPOSE 6379
VOLUME ["/data"]

# Use shell-form so $REDIS_PASSWORD expands at runtime.
CMD ["sh","-lc","exec redis-stack-server \
  --requirepass \"$REDIS_PASSWORD\" \
  --dir /data \
  --appendonly yes \
  --appendfsync everysec \
  --aof-use-rdb-preamble yes \
  --appendfilename appendonly.aof \
  --dbfilename dump.rdb"]